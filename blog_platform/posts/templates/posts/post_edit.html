{% extends 'core/core_base.html' %}
{% load static %}

{% block title %}Edit Post{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'posts_static/css/post_edit.css' %}">
<link rel="stylesheet" href="{% static 'posts_static/css/post_text_editor.css' %}">

<!-- Quill.js CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.snow.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="create-post-container">
    <div class="toolbar">
        <a href="{% url 'admin_post_list' %}" class="back-link">
            <i class="bi bi-arrow-left"></i>
            Back to Posts
        </a>
    </div>
    
    <form method="post" enctype="multipart/form-data" id="postForm" data-post-id="{{ post_id }}">
        {% csrf_token %}
        
        <!-- Category Selection -->
        <div class="form-group">
            <select name="category" class="category-select" required>
                <option value="">Loading categories...</option>
            </select>
        </div>
        
        <!-- Title Input -->
        <div class="form-group">
            <textarea 
                name="title" 
                class="title-input" 
                placeholder="Title" 
                maxlength="255"
                required
            ></textarea>
            <div class="char-count">
                <span id="titleCount">0</span>/255 characters
            </div>
        </div>
        
        <!-- Cover Image Upload -->
        <div class="form-group">
            <div class="image-upload-section" id="imageUploadSection">
                <input 
                    type="file" 
                    name="cover_image" 
                    id="coverImageInput" 
                    class="file-input" 
                    accept="image/jpeg,image/jpg,image/png,image/webp"
                    data-max-size="5242880"
                >
                <div class="upload-content" id="uploadContent">
                    <div class="upload-icon">
                        <i class="bi bi-image"></i>
                    </div>
                    <div class="upload-text">
                        <strong>Click to add a cover image (Optional)</strong> or drag and drop
                        <br><small>Recommended: 1200x630px | Max: 5MB</small>
                    </div>
                    <div class="file-type-info">
                        Supported formats: JPEG, PNG, WebP
                    </div>
                </div>
                
                <img id="imagePreview" class="image-preview" alt="Cover preview">
                
                <div class="image-info" id="imageInfo">
                    <div><strong>File:</strong> <span id="fileName"></span></div>
                    <div><strong>Size:</strong> <span id="fileSize"></span></div>
                    <div><strong>Dimensions:</strong> <span id="imageDimensions"></span></div>
                </div>
                
                <div class="image-actions" id="imageActions">
                    <button type="button" class="change-btn" onclick="document.getElementById('coverImageInput').click()">
                        <i class="bi bi-arrow-repeat me-1"></i>Change Image
                    </button>
                    <button type="button" class="remove-btn" id="removeImageBtn">
                        <i class="bi bi-trash me-1"></i>Remove
                    </button>
                </div>
            </div>
            
            <div class="error-message" id="imageError"></div>
            <div class="success-message" id="imageSuccess"></div>
        </div>
        
        <!-- Rich Text Editor -->
        <div class="form-group">
            <div class="editor-container" id="editorContainer">
                <div id="editor-toolbar">
                    <span class="ql-formats">
                        <select class="ql-header">
                            <option selected></option>
                            <option value="1"></option>
                            <option value="2"></option>
                            <option value="3"></option>
                        </select>
                        <select class="ql-size">
                            <option value="small"></option>
                            <option selected></option>
                            <option value="large"></option>
                            <option value="huge"></option>
                        </select>
                    </span>
                    
                    <span class="ql-formats">
                        <button class="ql-bold" title="Bold"></button>
                        <button class="ql-italic" title="Italic"></button>
                        <button class="ql-underline" title="Underline"></button>
                        <button class="ql-strike" title="Strike"></button>
                    </span>
                    
                    <span class="ql-formats">
                        <select class="ql-color" title="Text Color"></select>
                        <select class="ql-background" title="Background Color"></select>
                    </span>
                    
                    <span class="ql-formats">
                        <button class="ql-list" value="ordered" title="Numbered List"></button>
                        <button class="ql-list" value="bullet" title="Bullet List"></button>
                        <button class="ql-indent" value="-1" title="Decrease Indent"></button>
                        <button class="ql-indent" value="+1" title="Increase Indent"></button>
                    </span>
                    
                    <span class="ql-formats">
                        <button class="ql-script" value="sub" title="Subscript"></button>
                        <button class="ql-script" value="super" title="Superscript"></button>
                    </span>
                    
                    <span class="ql-formats">
                        <button class="ql-blockquote" title="Quote"></button>
                        <button class="ql-code-block" title="Code Block"></button>
                    </span>
                    
                    <span class="ql-formats">
                        <button class="ql-link" title="Link"></button>
                        <button class="ql-image" title="Image"></button>
                        <button class="ql-video" title="Video"></button>
                    </span>
                    
                    <span class="ql-formats">
                        <button class="ql-clean" title="Clear Formatting"></button>
                    </span>
                    
                    <div class="editor-actions">
                        <button type="button" class="fullscreen-toggle" id="fullscreenToggle" title="Toggle Fullscreen">
                            <i class="bi bi-arrows-fullscreen"></i>
                        </button>
                    </div>
                </div>
                
                <div id="editor"></div>
                
                <div class="editor-footer">
                    <div class="word-count">
                        <span><strong>Words:</strong> <span id="wordCount">0</span></span>
                        <span><strong>Characters:</strong> <span id="charCount">0</span></span>
                    </div>
                    <div class="reading-time">
                        <i class="bi bi-clock"></i>
                        <span id="readingTime">0 min read</span>
                    </div>
                </div>
            </div>
            
            <!-- Hidden textarea for form submission -->
            <textarea name="content" id="hiddenContent" style="display: none;" required></textarea>
        </div>
        
        <!-- File Attachments Section -->
        <div class="form-group">
            <label class="form-label">
                <i class="bi bi-paperclip me-1"></i>
                File Attachments
                <small class="text-muted">(Optional)</small>
            </label>
            
            <div class="attachments-section" id="attachmentsSection">
                <input 
                    type="file" 
                    id="attachmentInput" 
                    class="file-input" 
                    accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.rar,.jpg,.jpeg,.png,.gif,.webp,.mp4,.mp3,.wav"
                    data-max-size="10485760"
                >
                
                <div class="attachment-upload-area" id="attachmentUploadArea">
                    <div class="attachment-icon">
                        <i class="bi bi-cloud-upload"></i>
                    </div>
                    <div class="upload-text" id="attachmentUploadPrompt">
                        <strong>Click to add a file attachment</strong> or drag and drop
                        <br><small>Max: 10MB</small>
                    </div>
                    <div class="file-type-info">
                        Supported: Documents, Images, Videos, Audio, Archives
                    </div>
                </div>
                
                <div class="attachment-preview" id="attachmentPreview" style="display: none;">
                    <div class="attachment-item">
                        <i id="attachmentIcon" class="bi bi-file-earmark"></i>
                        <div class="attachment-info" id="attachmentInfo" style="display: none;">
                            <div class="attachment-name" id="attachmentName"></div>
                            <div class="attachment-size" id="attachmentSize"></div>
                            <div class="attachment-type" id="attachmentType"></div>
                        </div>
                        <div class="attachment-actions" id="attachmentActions" style="display: none;">
                            <button id="removeAttachmentBtn" class="btn-remove-attachment">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="error-message" id="attachmentError"></div>
                <div class="success-message" id="attachmentSuccess"></div>
            </div>
        </div>
        
        <!-- Update Section -->
        <div class="publish-section">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <button type="submit" class="edit-btn" id="editBtn">
                        <i class="bi bi-pencil-square me-1"></i>
                        Update Post
                    </button>
                </div>
                <small class="text-muted">
                    <i class="bi bi-globe me-1"></i>
                    This will be visible to everyone
                </small>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<!-- Quill.js JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.min.js"></script>
<script type="module" src="{% static 'posts_static/js/post_edit.js' %}" defer></script>
{% endblock %}