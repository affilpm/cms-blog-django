{% extends 'core/admin_base.html' %}
{% load static %}

{% block extra_css %}
{{ block.super }}
    <link rel="stylesheet" href="{% static 'admin_panel_static/css/admin_comments_list.css' %}">
{% endblock %}

{% block main_content %}
<div id="comments-section" class="content-view">
    <div class="glass rounded-3 p-4">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
            <h3 class="text-white mb-3 mb-md-0">Comments Management</h3>
            <button class="btn btn-success" id="approveAllBtn">
                <i class="fas fa-check me-2"></i>Approve All
            </button>
        </div>
        <div class="table-responsive">
            <table class="table table-glass">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Comment</th>
                        <th>Author</th>
                        <th>Post</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="commentsTbody">
                    {% for comment in comments %}
                    <tr>
                        <td>{{ comment.id }}</td>
                        <td>
                            <div class="comment-text" 
                                 title="{{ comment.content }}"
                                 style="cursor: pointer;"
                                 onclick="showCommentModal({
                                     id: {{ comment.id }},
                                     author: '{{ comment.user.username|escapejs }}',
                                     post: '{{ comment.post.title|escapejs }}',
                                     date: '{{ comment.created_at|date:"M d, Y" }}',
                                     status: '{{ comment.is_approved|yesno:"Approved,Pending" }}',
                                     content: '{{ comment.content|escapejs }}'
                                 })">
                                {% if comment.content|length > 50 %}
                                    {{ comment.content|slice:":50" }}...
                                {% else %}
                                    {{ comment.content }}
                                {% endif %}
                            </div>
                        </td>
                        <td>{{ comment.user.username }}</td>
                        <td>{{ comment.post.title }}</td>
                        <td>
                            <span class="badge {% if comment.is_approved %}status-published{% else %}status-pending{% endif %}">
                                {% if comment.is_approved %}Approved{% else %}Pending{% endif %}
                            </span>
                        </td>
                        <td>{{ comment.created_at|date:"M d, Y" }}</td>
                        <td>
                            <button 
                                class="btn {% if comment.is_approved %}btn-success{% else %}btn-outline-success{% endif %} btn-lg" 
                                data-comment-id="{{ comment.id }}"
                                onclick="toggleCommentStatus({{ comment.id }}, {% if comment.is_approved %}'approved'{% else %}'pending'{% endif %})"
                                title="{% if comment.is_approved %}Approved - Click to set Pending{% else %}Pending - Click to Approve{% endif %}">
                                {% if comment.is_approved %}
                                    <i class="fas fa-check"></i>
                                {% else %}
                                    <i class="fas fa-clock"></i>
                                {% endif %}
                            </button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="text-center">No comments found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Comment Modal -->
<div class="modal fade" id="commentModal" tabindex="-1" aria-labelledby="commentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark">
            <div class="modal-header border-secondary">
                <h5 class="modal-title text-white" id="commentModalLabel">Comment Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong class="text-white">ID:</strong>
                        <span class="text-light" id="modalCommentId"></span>
                    </div>
                    <div class="col-md-6">
                        <strong class="text-white">Status:</strong>
                        <span id="modalCommentStatus" class="badge ms-2"></span>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong class="text-white">Author:</strong>
                        <span class="text-light" id="modalCommentAuthor"></span>
                    </div>
                    <div class="col-md-6">
                        <strong class="text-white">Date:</strong>
                        <span class="text-light" id="modalCommentDate"></span>
                    </div>
                </div>
                <div class="mb-3">
                    <strong class="text-white">Post:</strong>
                    <span class="text-light" id="modalCommentPost"></span>
                </div>
                <div class="mb-3">
                    <strong class="text-white">Comment:</strong>
                    <div class="mt-2 p-3 bg-secondary bg-opacity-25 rounded">
                        <p class="text-light mb-0" id="modalCommentContent" style="white-space: pre-wrap;"></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
    <script type="module" src="{% static 'admin_panel_static/js/admin_comments_list.js' %}" defer></script>
{% endblock %}